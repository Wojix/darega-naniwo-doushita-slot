<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>誰が何をどうしたスロット</title>
<style>
  body { font-family: sans-serif; text-align: center; background-color: #f0f0f0; padding: 50px; position: relative; }
  .slot-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
  .slot { width: 150px; height: 50px; line-height: 50px; background: #fff; border: 3px solid #333; border-radius: 10px; font-size: 18px; font-weight: bold; }
  button { padding: 10px 30px; font-size: 18px; border-radius: 10px; cursor: pointer; }
  select, input[type=number], textarea { font-size: 16px; padding: 5px 10px; margin: 5px; }
  .player-boxes { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }
  .player-box { width: 120px; padding: 5px; border: 2px solid #333; border-radius: 5px; background: #fff; text-align: center; }
  .input-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
  .input-box { display: flex; flex-direction: column; gap: 5px; }
  textarea { width: 200px; height: 100px; resize: none; }
</style>
</head>
<body>
<h1>誰が何をどうしたスロット</h1>

<div style="position: absolute; top: 20px; right: 20px;">
  <select id="templateSelect" onchange="changeTemplate()">
    <option value="home">家でできるやつ</option>
    <option value="custom">カスタムテンプレ</option>
  </select>
  <br>
  <label>プレイヤー数: <input type="number" id="playerCount" min="1" max="50" value="3" onchange="updatePlayerBoxes()"></label>
</div>

<div class="player-boxes" id="playerBoxes"></div>

<div class="input-container">
  <div class="input-box">
    <label>アクションを入力（1行1つ）</label>
    <textarea id="actionInput">ケーキを食べた
歌った
掃除した
寝た
ゲームした</textarea>
  </div>
  <div class="input-box">
    <label>場所を入力（1行1つ）</label>
    <textarea id="placeInput">リビングで
お風呂で
台所で
ベッドで
窓際で</textarea>
  </div>
</div>

<div class="slot-container">
  <div id="slot1" class="slot">誰が</div>
  <div id="slot2" class="slot">どうした</div>
  <div id="slot3" class="slot">何を</div>
</div>
<button onclick="spinSlots()">スロット回す！</button>

<script>
const templates = {
  home: { whos: [], actions: [], whats: [] },
  custom: { whos: [], actions: [], whats: [] }
};

let currentTemplate = templates.home;

function changeTemplate() {
  const select = document.getElementById("templateSelect");
  const value = select.value;
  currentTemplate = templates[value];
  updatePlayerBoxes();
  updateActionsPlaces();
}

function updatePlayerBoxes() {
  const container = document.getElementById("playerBoxes");
  container.innerHTML = "";
  const count = parseInt(document.getElementById("playerCount").value);

  templates.custom.whos = [];
  for(let i=1;i<=count;i++){
    const box = document.createElement("input");
    box.type = "text";
    box.placeholder = "プレイヤー"+i;
    box.className = "player-box";
    box.oninput = () => { templates.custom.whos[i-1] = box.value || "プレイヤー"+i; }
    box.value = "プレイヤー"+i;
    templates.custom.whos.push(box.value);
    container.appendChild(box);
  }

  currentTemplate.whos = templates.custom.whos;
}

function updateActionsPlaces(triggerFromEdit=false) {
  const actions = document.getElementById("actionInput").value.split("\n").filter(a=>a.trim()!=="");
  const places = document.getElementById("placeInput").value.split("\n").filter(a=>a.trim()!=="");

  // 編集されたら自動でカスタムモードに変更
  if(triggerFromEdit && document.getElementById("templateSelect").value !== "custom"){
    document.getElementById("templateSelect").value = "custom";
    currentTemplate = templates.custom;
  }

  currentTemplate.actions = actions;
  currentTemplate.whats = places;
}

// 編集イベントで自動切替
document.getElementById("actionInput").addEventListener("input",()=>updateActionsPlaces(true));
document.getElementById("placeInput").addEventListener("input",()=>updateActionsPlaces(true));

function randomElement(arr) { return arr[Math.floor(Math.random()*arr.length)]; }

function spinSlots() {
  updateActionsPlaces();

  const slot1 = document.getElementById("slot1");
  const slot2 = document.getElementById("slot2");
  const slot3 = document.getElementById("slot3");

  if(currentTemplate.whos.length===0){ alert("プレイヤーが設定されていません！"); return; }
  if(currentTemplate.actions.length===0 || currentTemplate.whats.length===0){ alert("アクションまたは場所が設定されていません！"); return; }

  let i=0;
  const interval = setInterval(()=>{
    slot1.textContent = randomElement(currentTemplate.whos);
    slot2.textContent = randomElement(currentTemplate.whats);
    slot3.textContent = randomElement(currentTemplate.actions);
    i++;
    if(i>20) clearInterval(interval);
  },100);
}

// 初期化
updatePlayerBoxes();
updateActionsPlaces();
</script>
</body>
</html>
